\documentclass{article}
\usepackage{ifthen}
\usepackage{pst-all}
\usepackage{auto-pst-pdf}
\usepackage{com.braju.graphicalmodels}
\catcode`\@=11%
\pagestyle{empty}
\begin{document}

\newlength{\gmunit}
\setlength{\gmunit}{12mm}

\TeXtoEPS
\psset{unit=\gmunit,arrowscale=1.5}
\SpecialCoor


\begin{pspicture}(0,0)(14,18)
% \showgrid

% node utils
\newcommand{\node}[4]{\rput(#1){\GM@node[nodeSize=\gmunit]{#3}}\GM@label[offset=#2\gmunit]{#3}{#4}}
\newcommand{\dnode}[4]{\rput(#1){\GM@node[nodeSize=\gmunit]{#3}}\rput(#1){\GM@node[nodeSize=0.9\gmunit]{nil}}\GM@label[offset=#2\gmunit]{#3}{#4}}
\newcommand{\onode}[4]{\rput(#1){\GM@node[nodeSize=\gmunit,observed=true,observedColor=lightgray]{#3}}\GM@label[offset=#2\gmunit]{#3}{#4}}
\newcommand{\qnode}[4]{\rput(#1){\GM@node[nodeSize=\gmunit,query=true]{#3}}\GM@label[offset=#2\gmunit]{#3}{#4}}
\newcommand{\darr}[2]{\ncline[arrows=->]{#1}{#2}}

% jitter model
\node{5,17}{-0.1}{delta}{$\delta$}
\node{7,17}{-0.1}{eta}{$\eta$}

% generative model
\node{9,15}{-0.15}{f0}{$f_0^i$}
\node{11,13}{-0.15}{fstar}{$f_*^\alpha$}

% generated counts and variance
\dnode{8,12}{-0.25}{C0}{$C^{i\alpha}$}
\dnode{5,11}{-0.25}{sig0}{$\sigma^{i\alpha}$}

% bad and variable hyperparams
\node{0,10}{-0.3}{Sigbad}{$\Sigma_\mathrm{bad}$}
\node{13,10}{-0.3}{Sigvar}{$\Sigma_\mathrm{var}$}
\qnode{11,6}{-0.25}{qvar}{$q_\mathrm{var}^\alpha$}
\qnode{3,8}{-0.25}{qbad}{$q_\mathrm{bad}^{i\alpha}$}

% bad, variance, const, etc. counts
\node{4,9}{-0.3}{Cbad}{$C_\mathrm{bad}^{i\alpha}$}
\node{6,9}{-0.35}{Cconst}{$C_\mathrm{const}^{i\alpha}$}
\node{8,9}{-0.3}{Cvar}{$C_\mathrm{var}^{i\alpha}$}
\dnode{7,6}{-0.25}{Cvar2}{$\bar{C}_\mathrm{var}^{i\alpha}$}
\dnode{5,6}{-0.35}{Cconst2}{$\bar{C}_\mathrm{const}^{i\alpha}$}

% observations
\onode{3,12}{-0.25}{sigobs}{$\sigma_\mathrm{obs}^{i\alpha}$}
\onode{6,4}{-0.3}{Cobs}{$C_\mathrm{obs}^{i\alpha}$}


\darr{fstar}{C0}
\darr{f0}{C0}
\darr{delta}{sig0}
\darr{eta}{sig0}
\darr{C0}{sig0}
\darr{sigobs}{sig0}
\darr{C0}{Cbad}
\darr{sig0}{Cbad}
\darr{Sigbad}{Cbad}
\darr{C0}{Cconst}
\darr{sig0}{Cconst}
\darr{C0}{Cvar}
\darr{sig0}{Cvar}
\darr{Sigvar}{Cvar}
\darr{Cbad}{Cvar2}
\darr{Cvar}{Cvar2}
\darr{qbad}{Cvar2}
\darr{Cbad}{Cconst2}
\darr{Cconst}{Cconst2}
\darr{qbad}{Cconst2}
\darr{Cconst2}{Cobs}
\darr{Cvar2}{Cobs}
\darr{qvar}{Cobs}

\rput(1,3){\GM@plate[plateLabelPos=tl]{9}{13}{\hspace{3mm}Runs: $i = 1, \ldots, M$}}
\rput(2,2){\GM@plate[plateLabelPos=br]{10}{12}{Stars: $\alpha = 1, \ldots, N$\hspace{3mm}}}

\end{pspicture}
\endTeXtoEPS
\end{document}

